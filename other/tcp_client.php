<?php
	date_default_timezone_set('Asia/Chongqing');
//	if(($socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP))===false){
//		echo "socket_create() failed, reason: ".socket_strerror(socket_last_error())."\n";
//	}
//	$con = socket_connect($socket, '10.73.12.69',50000);
//	if(!$con){
//		socket_close($socket);
//		echo "connect failed\n";
//		exit;
//	}
	
	$header="<mobile_query>";
	$prefix="{\"log_type\":1,\"status\":1000,\"date\":\"";
//	$time = date("Y-m-d H:i:s");
	$postfix="\",\"uid\":\"2758877987\",\"search\":\"\u6768\u5e42\",\"ip\":\"10.235.21.24\",\"Mozilla\":\"1073193010\",\"module\":[{\"cate\":1,\"info\":[{\"uid\":1195242865,\"cate\":1}]},{\"cate\":15,\"info\":[{\"uid\":\"1557721227\"},{\"uid\":\"1733275311\"},{\"uid\":\"3261134763\"},{\"uid\":\"2824548085\"},{\"uid\":\"2744950651\"},{\"uid\":\"1728698130\"},{\"uid\":\"1927839815\"},{\"uid\":\"2719391712\"},{\"uid\":\"5809214553\"},{\"uid\":\"1000507691\"},{\"uid\":\"1787699781\"}]},{\"cate\":123,\"info\":[{\"sid\":1195242865}]},{\"cate\":25,\"object_id\":\"1022:100808e8d586dd7436fe56dd79b9b4f6c69350\"},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091303652964275\",\"social\":1,\"cluster\":2,\"stat\":[1185,591,2968]}]},{\"cate\":72,\"info\":[{\"mid\":\"4091110508786941\",\"social\":1,\"cluster\":2,\"stat\":[110,228,428]}]},{\"cate\":3},{\"cate\":2},{\"cate\":79,\"info\":[{\"doc_id\":\"17786149795170004423\",\"is_headimg\":1},{\"doc_id\":\"9372192221334774203\",\"is_headimg\":0},{\"doc_id\":\"1558486401177186535\",\"is_headimg\":0}]},{\"cate\":31,\"info\":[{\"mid\":\"4091488092791061\",\"stat\":[0,0,0]},{\"mid\":\"4091482069571185\",\"social\":1,\"cluster\":2,\"stat\":[17,84,81]},{\"mid\":\"4091486960205623\",\"stat\":[0,0,4]},{\"mid\":\"4091483130937597\",\"social\":1,\"cluster\":2,\"stat\":[32,325,137]},{\"mid\":\"4091486343191468\",\"stat\":[0,0,5]}]},{\"cate\":125,\"info\":[]},{\"cate\":113,\"info\":[{\"mid\":\"4091486339205055\",\"stat\":[0,0,3]},{\"mid\":\"4091486120844169\",\"stat\":[0,0,0]},{\"mid\":\"4091485877889415\",\"stat\":[0,0,0]},{\"mid\":\"4091485811557322\",\"stat\":[1,0,16]},{\"mid\":\"4091463467696229\",\"social\":1,\"cluster\":2,\"stat\":[0,28,78]},{\"mid\":\"4091455641687781\",\"social\":1,\"cluster\":2,\"stat\":[9,65,87]},{\"mid\":\"4091484917370333\",\"stat\":[0,0,0]},{\"mid\":\"4091484473400042\",\"stat\":[1,1,8]},{\"mid\":\"4091351736071127\",\"social\":1,\"cluster\":2,\"stat\":[22,385,631]},{\"mid\":\"4091484300919589\",\"stat\":[2,1,4]},{\"mid\":\"4091449038898411\",\"social\":1,\"cluster\":3,\"stat\":[781,505,1135]},{\"mid\":\"4091483588180171\",\"stat\":[0,0,2]},{\"mid\":\"4091483583787605\",\"stat\":[0,0,2]},{\"mid\":\"4091483222822799\",\"stat\":[0,0,15]},{\"mid\":\"4091483072094002\",\"stat\":[0,0,6]}]},{\"cate\":19,\"info\":[]}],\"v_p\":\"45\",\"cid\":\"100103type=1&q=\u6768\u5e42&t=4\",\"sid\":\"t_wap_ios\",\"type\":\"1\",\"t\":\"4\",\"page\":\"1\",\"seqid\":31058929,\"nettype\":\"wifi\",\"gis\":\"116.269362,40.040289\",\"ua\":\"iPhone8,2__weibo__7.3.1__iphone__os9.3.5\",\"refer\":\"\",\"uicode\":\"10000003\",\"luicode\":\"10000010\",\"lfid\":\"231091\",\"ext\":[]}";

	// 5.5 k
	//$postfix="\",\"uid\":\"2758877987\",\"search\":\"杨幂\",\"ip\":\"10.235.21.24\",\"Mozilla\":\"1073193010\",\"module\":[{\"cate\":1,\"info\":[{\"uid\":1195242865,\"cate\":1}]},{\"cate\":15,\"info\":[{\"uid\":\"1557721227\"},{\"uid\":\"1733275311\"},{\"uid\":\"3261134763\"},{\"uid\":\"2824548085\"},{\"uid\":\"2744950651\"},{\"uid\":\"1728698130\"},{\"uid\":\"1927839815\"},{\"uid\":\"2719391712\"},{\"uid\":\"5809214553\"},{\"uid\":\"1000507691\"},{\"uid\":\"1787699781\"}]},{\"cate\":123,\"info\":[{\"sid\":1195242865}]},{\"cate\":25,\"object_id\":\"1022:100808e8d586dd7436fe56dd79b9b4f6c69350\"},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091101540955687\",\"social\":1,\"cluster\":6,\"stat\":[1064020,24828,176892]},{\"mid\":\"4090720241038204\",\"social\":1,\"cluster\":2,\"stat\":[934474,69744,642064]}]},{\"cate\":26,\"info\":[{\"mid\":\"4091303652964275\",\"social\":1,\"cluster\":2,\"stat\":[1185,591,2968]}]},{\"cate\":72,\"info\":[{\"mid\":\"4091110508786941\",\"social\":1,\"cluster\":2,\"stat\":[110,228,428]}]},{\"cate\":3},{\"cate\":2},{\"cate\":79,\"info\":[{\"doc_id\":\"17786149795170004423\",\"is_headimg\":1},{\"doc_id\":\"9372192221334774203\",\"is_headimg\":0},{\"doc_id\":\"1558486401177186535\",\"is_headimg\":0}]},{\"cate\":31,\"info\":[{\"mid\":\"4091488092791061\",\"stat\":[0,0,0]},{\"mid\":\"4091482069571185\",\"social\":1,\"cluster\":2,\"stat\":[17,84,81]},{\"mid\":\"4091486960205623\",\"stat\":[0,0,4]},{\"mid\":\"4091483130937597\",\"social\":1,\"cluster\":2,\"stat\":[32,325,137]},{\"mid\":\"4091486343191468\",\"stat\":[0,0,5]}]},{\"cate\":125,\"info\":[]},{\"cate\":113,\"info\":[{\"mid\":\"4091486339205055\",\"stat\":[0,0,3]},{\"mid\":\"4091486120844169\",\"stat\":[0,0,0]},{\"mid\":\"4091485877889415\",\"stat\":[0,0,0]},{\"mid\":\"4091485811557322\",\"stat\":[1,0,16]},{\"mid\":\"4091463467696229\",\"social\":1,\"cluster\":2,\"stat\":[0,28,78]},{\"mid\":\"4091455641687781\",\"social\":1,\"cluster\":2,\"stat\":[9,65,87]},{\"mid\":\"4091484917370333\",\"stat\":[0,0,0]},{\"mid\":\"4091484473400042\",\"stat\":[1,1,8]},{\"mid\":\"4091351736071127\",\"social\":1,\"cluster\":2,\"stat\":[22,385,631]},{\"mid\":\"4091484300919589\",\"stat\":[2,1,4]},{\"mid\":\"4091449038898411\",\"social\":1,\"cluster\":3,\"stat\":[781,505,1135]},{\"mid\":\"4091483588180171\",\"stat\":[0,0,2]},{\"mid\":\"4091483583787605\",\"stat\":[0,0,2]},{\"mid\":\"4091483222822799\",\"stat\":[0,0,15]},{\"mid\":\"4091483072094002\",\"stat\":[0,0,6]}]},{\"cate\":19,\"info\":[]}],\"v_p\":\"45\",\"cid\":\"100103type=1&q=杨幂&t=4\",\"sid\":\"t_wap_ios\",\"type\":\"1\",\"t\":\"4\",\"page\":\"1\",\"seqid\":31058929,\"nettype\":\"wifi\",\"gis\":\"116.269362,40.040289\",\"ua\":\"iPhone8,2__weibo__7.3.1__iphone__os9.3.5\",\"refer\":\"\",\"uicode\":\"10000003\",\"luicode\":\"10000010\",\"lfid\":\"231091\",\"ext\":[]}\n";
	
//	$msgsend = $header.$prefix.$time.$postfix."\n";
//	echo $msgsend;
	$count = 0;
//	while($con and $count < 1000){
	while( $count < 1000){
		if(($socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP))===false){
			echo "socket_create() failed, reason: ".socket_strerror(socket_last_error())."\n";
		}
		//$con = socket_connect($socket, '10.73.12.69',50000);
		$con = socket_connect($socket, '172.16.42.23',50000);
		if(!$con){
			socket_close($socket);
			echo "connect failed\n";
			exit;
		}
//		$hear = socket_read($socket, 1024);
//		echo $hear;
		
		$time = date("Y-m-d H:i:s");
		$msgsend = $header.$prefix.$time.$postfix."\n";
		socket_write($socket, $msgsend);
		$count ++;
		echo $count."\n";

//		socket_shutdown($socket);
		socket_close($socket);
	}
//	socket_shutdown($socket);
//	socket_close($socket);
?>

	
